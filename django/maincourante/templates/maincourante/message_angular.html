{% extends 'maincourante/base.html' %}

{% load staticfiles %}
{% load bootstrap3 %}
{% load message_tags %}

{% block saisitab %} class="active"{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/autocomplete.css' %}">
{% endblock %}

{% block content %}
<diV ng-app="maincouranteApp">
<div ng-controller="MainCtrl">

    <div class="panel panel-primary">
        <div class="panel-heading">
            <h4>Saisie des messages</h4>
        </div>
        <div class="panel-body panel-body-md">
            <form class="form-horizontal">
            {% csrf_token %}
                <div class="form-group">
			    <label class="col-md-3 control-label" for="id_destinataire">Destinataire</label>
                <div class="col-md-6">
                        <angucomplete-alt id="receiver"
                                          placeholder="Destinataire"
                                          pause="100"
                                          selected-object="receiver"
                                          local-data="indicatifs"
                                          search-fields="name"
                                          title-field="name"
                                          minlength="1"
                                          focuson="onNewMessage"
                                          override-suggestions="true"
                                          input-class="form-control form-control-small"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Expéditeur</label>
                    <div class="col-md-6">
                        <angucomplete-alt id="sender"
                                          placeholder="Expéditeur"
                                          pause="100"
                                          selected-object="sender"
                                          local-data="indicatifs"
                                          search-fields="name"
                                          title-field="name"
                                          ng-model="from"
                                          minlength="1"
                                          override-suggestions="true"
                                          input-class="form-control form-control-small"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Message</label>
                    <div class="col-md-6">
                        <input type="text" class="form-control" name="body" ng-model="body" placeholder="Message">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Réponse</label>
                    <div class="col-md-6">
                        <input  type="text" class="form-control" name="reponse" ng-model="response" placeholder="Réponse"/>
                    </div>
                </div>
                {% buttons layout="horizontal" %}
                        <button type="submit" ng-click="addMessage()" class="btn btn-primary">Envoyer</button>
                {% endbuttons %}
            </form>
        </div>
    </div>
    <div ng-if="errorMessage" class="alert alert-danger">
        <a href="" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>Erreur </strong> {$errorMessage$}
    </div>

    <messages ng-init="editionMode = true;"/>

    <br/>
    <script>

        var csrf = '{{ csrf_token|escapejs }}';
        var EVENEMENT = '{{ evenement.nom }}';

        var toto = "{% static "css/maincourante.css" %}";
    </script>
    <script type="text/ng-template" id="modal-delete-message.html">
            <div class="modal-header">
            <h3 class="modal-title">Suppression de message ?</h3>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer ce message ? Si oui veuillez donner une raison.
                <input focus-on="onDelete" type="text" class="form-control" placeholder="Raison" ng-model="suppressionMessage">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" ng-click="ok()">Oui</button>
                <button class="btn btn-warning" type="button" ng-click="cancel()">Non</button>
            </div>
    </script>

    <script type="text/ng-template" id="modal-reply-message.html">
        <div class="modal-header">
            <h3 class="modal-title">Ecrire une réponse</h3>
        </div>
        <div class="modal-body">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-md-3 control-label">Destinataire</label>
                    <div class="col-md-6">
                        <input  disabled type="text" class="form-control" name="reponse" ng-model="message.receiver" placeholder="Réponse"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Expéditeur</label>
                    <div class="col-md-6">
                        <input disabled type="text" class="form-control" name="reponse" ng-model="message.sender" placeholder="Réponse"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Message</label>
                    <div class="col-md-6">
                        <input disabled type="text" class="form-control" name="reponse" ng-model="message.body" placeholder="Réponse"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Réponse</label>
                    <div class="col-md-6">
                        <input focus-on="onReply" type="text" class="form-control" name="reponse" ng-model="response" placeholder="Réponse"/>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="ok()">Envoyer</button>
            <button class="btn btn-warning" type="button" ng-click="cancel()">Annuler</button>
        </div>
    </script>

    <script src="{% static "scripts/bower_components/angular/angular.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angular-route/angular-route.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angular-animate/angular-animate.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angular-resource/angular-resource.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angular-bootstrap/ui-bootstrap.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angular-bootstrap/ui-bootstrap-tpls.js" %}" ></script>
    <script src="{% static "scripts/bower_components/angucomplete-alt/angucomplete-alt.js" %}" ></script>
    <script src="{% static "scripts/bower_components/ng-focus-on/ng-focus-on.js" %}" ></script>
    <script src="{% static "scripts/maincourante/entities/message.js" %}" ></script>
    <script src="{% static "scripts/maincourante/entities/indicatif.js" %}" ></script>
    <script src="{% static "scripts/maincourante/controllers/message_controller.js" %}" ></script>
    <script src="{% static "scripts/maincourante/directives/message_directive.js" %}" ></script>
    <script src="{% static "scripts/maincourante/app.js" %}" ></script>

    <link rel="stylesheet" href="{% static "css/maincourante.css" %}">
    <link rel="stylesheet" href="{% static "scripts/bower_components/angucomplete-alt/angucomplete-alt.css" %}">

</div>
{% endblock %}
